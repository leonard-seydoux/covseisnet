
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_example_1.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_plot_example_1.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_example_1.py:


Single-station covariance matrix
================================

Interchannel spectral covariance matrix calculated from the example trace
available in obspy.

We consider the continuous seismograms at the station RJOB from the BW seismic
network. The data is available in the obspy example data, readable without any
argument. In this case, the covariance matrix is calculated between the three
channels of the station RJOB, and has three components. 

The following example use a Fourier estimation window of 1 second and is
estimated over 5 consecutive windows.

.. GENERATED FROM PYTHON SOURCE LINES 16-78



.. image-sg:: /auto_examples/images/sphx_glr_plot_example_1_001.png
   :alt: plot example 1
   :srcset: /auto_examples/images/sphx_glr_plot_example_1_001.png, /auto_examples/images/sphx_glr_plot_example_1_001_4_00x.png 4.00x
   :class: sphx-glr-single-img





.. code-block:: Python


    import matplotlib.pyplot as plt
    import numpy as np

    import covseisnet as csn

    # Read example stream
    stream = csn.read()

    # Pre-process stream
    stream.detrend("linear")
    stream.taper(max_percentage=0.05)
    stream.filter("highpass", freq=2)


    # Get channels
    channels = [trace.stats.channel for trace in stream]

    # Calculate covariance matrix
    times, frequencies, covariances = csn.calculate_covariance_matrix(
        stream,
        window_duration_sec=1.0,
        average=4,
    )

    # Calculate coherence
    coherence = covariances.coherence()

    # show covariance from first window and first frequency
    covariance_show = np.random.rand(3, 3)

    # Show
    fig, ax = plt.subplots(nrows=2, ncols=1, sharex=True, constrained_layout=True)

    # Show trace
    for index, trace in enumerate(stream):
        waveform = trace.data
        waveform /= np.max(np.abs(waveform))
        ax[0].plot(trace.times(), waveform + index, label=trace.stats.channel)
    mappable = ax[1].pcolormesh(
        times, frequencies, coherence.T, cmap="magma_r", vmin=0, vmax=1
    )

    # Labels
    ax[0].grid()
    ax[0].set_ylabel("Amplitude (counts)")
    ax[1].set_yscale("log")
    ax[1].set_ylim(frequencies[1], frequencies[-1] / 2)
    ax[1].set_xlabel("Time (s)")
    ax[1].set_ylabel("Frequency (Hz)")
    plt.colorbar(mappable).set_label("Covariance matrix\nspectral width")

    # mappable = ax.matshow(covariance_show, vmin=0, vmax=1, cmap="RdPu")

    # Axes
    # channels = [trace.stats.channel for trace in stream]
    # ax.set_xticks(range(len(stream)), labels=channels)
    # ax.set_yticks(range(len(stream)), labels=channels)

    # # Labels
    # ax.set_title("Single-station channel-wise covariance")
    # plt.colorbar(mappable).set_label("Covariance modulus")


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 0.651 seconds)


.. _sphx_glr_download_auto_examples_plot_example_1.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_example_1.ipynb <plot_example_1.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_example_1.py <plot_example_1.py>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
