
<!DOCTYPE html>


<html lang="english" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Covariance Matrix &#8212; covseisnet</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery.css?v=d2d258e8" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-binder.css?v=f4aeca0c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-dataframe.css?v=2082cf3c" />
    <link rel="stylesheet" type="text/css" href="_static/sg_gallery-rendered-html.css?v=1277b6f3" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=17ebe808" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=e872a992"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'covariance';</script>
    <link rel="icon" href="_static/logo_covseisnet_small.svg"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cross-correlation matrix" href="correlation.html" />
    <link rel="prev" title="Signal processing" href="signal.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="english"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo_covseisnet_normal.svg" class="logo__image only-light" alt="Covseisnet logo"/>
    <script>document.write(`<img src="_static/logo_covseisnet_normal.svg" class="logo__image only-dark" alt="Covseisnet logo"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="index.html">
                    Home
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="auto_examples/index.html">Gallery</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_a1_sync.html">Traces synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_a2_norm.html">Temporal normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_a3_whiten.html">Spectral whitening</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_b1_coherence.html">Spectral width</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_b2_coherence_preprocess.html">Compare pre-processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_c1_correlations.html">Cross-correlation at USArray</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_d1_constant_velocity.html">Constant velocity travel times</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_d2_constant_velocity_diff.html">Constant velocity differential times</a></li>
<li class="toctree-l2"><a class="reference internal" href="auto_examples/plot_example_d3_constant_velocity_loc.html">Locating events within a constant velocity model</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="api.html">API Reference</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="stream.html">Network stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="signal.html">Signal processing</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Covariance Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlation.html">Cross-correlation matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="plot.html">Plotting tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="data.html">Data management</a></li>
<li class="toctree-l2"><a class="reference internal" href="spatial.html">Geographical and spatial functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="velocity.html">Velocity models</a></li>
<li class="toctree-l2"><a class="reference internal" href="travel_times.html">Travel times</a></li>
<li class="toctree-l2"><a class="reference internal" href="backprojection.html">Backprojection</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/leonard-seydoux/covseisnet" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/leonard-seydoux/covseisnet/issues/new?title=Issue%20on%20page%20%2Fcovariance.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Covariance Matrix</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.coherence"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.coherence()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.eigenvalues()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.eigenvectors"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.eigenvectors()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.flat"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.flat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.triu"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.triu()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.twosided"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.twosided()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.is_hermitian"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.is_hermitian</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.calculate_covariance_matrix"><code class="docutils literal notranslate"><span class="pre">calculate_covariance_matrix()</span></code></a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="module-covseisnet.covariance">
<span id="covariance-matrix"></span><h1>Covariance Matrix<a class="headerlink" href="#module-covseisnet.covariance" title="Link to this heading">#</a></h1>
<p>Calculation and analysis of the network covariance matrix.</p>
<dl class="py class">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">covseisnet.covariance.</span></span><span class="sig-name descname"><span class="pre">CovarianceMatrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_array</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><span class="pre">CovarianceMatrix</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">stats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.obspy.org/packages/autogen/obspy.core.trace.Stats.html#obspy.core.trace.Stats" title="(in ObsPy v1.4.1)"><span class="pre">Stats</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.13)"><span class="pre">list</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><span class="pre">dict</span></a><span class="p"><span class="pre">]</span></span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stft</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="signal.html#covseisnet.signal.ShortTimeFourierTransform" title="covseisnet.signal.ShortTimeFourierTransform"><span class="pre">ShortTimeFourierTransform</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix" title="Link to this definition">#</a></dt>
<dd><p>Bases: <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ndarray</span></code></a></p>
<p>This class inherits all the methods of standard numpy arrays, along with
extra methods tailored for array processing. Any numpy method or function
applied to an instance of CovarianceMatrix will return an instance of
CovarianceMatrix.</p>
<p class="rubric">Mathematical definition</p>
<p>We consider the set of network seismograms <span class="math notranslate nohighlight">\(\{v_i(t)\}_{i=1}^N\)</span> with
<span class="math notranslate nohighlight">\(N\)</span> traces, all recorded on the same time samples (synchronized).
For the sake of simplicity, we use the continuous time notation. We first
calculate the short-time Fourier transform of each trace within a sliding
window of duration <span class="math notranslate nohighlight">\(T\)</span>, and center time <span class="math notranslate nohighlight">\(t_m\)</span> (with the index
<span class="math notranslate nohighlight">\(m\)</span> the time window index), defined on the time interval
<span class="math notranslate nohighlight">\(\tau_m = [t_m - T/2, t_m + T/2]\)</span>. The short-time Fourier transform
of the traces is defined as</p>
<div class="math notranslate nohighlight">
\[u_{i,m}(f) = \mathcal{F} v_i(t \in \tau_m)\]</div>
<p>The spectral covariance matrix is defined as the average of the outer
product of the short-time Fourier transform of the traces over a set of
time windows <span class="math notranslate nohighlight">\(\{\tau_m\}_{m=1}^M\)</span>, with <span class="math notranslate nohighlight">\(M\)</span> the number of
windows used to estimate the covariance. This lead to the definition of
the spectral covariance matrix <span class="math notranslate nohighlight">\(C_{ij}(f)\)</span> as</p>
<div class="math notranslate nohighlight">
\[C_{ij}(f) = \sum_{m=1}^M u_{i,m}(f) u_{j,m}^*(f)\]</div>
<p>where <span class="math notranslate nohighlight">\(M\)</span> is the number of windows used to estimate the covariance,
<span class="math notranslate nohighlight">\(^*\)</span> is the complex conjugate, and <span class="math notranslate nohighlight">\(\tau_m\)</span> is the time window
of index <span class="math notranslate nohighlight">\(m\)</span>. The covariance matrix is a complex-valued matrix of
shape <span class="math notranslate nohighlight">\(N \times N\)</span>.</p>
<p class="rubric">Practical implementation</p>
<p>The short-time Fourier transform is calculated with the help of the
<a class="reference internal" href="signal.html#covseisnet.signal.ShortTimeFourierTransform" title="covseisnet.signal.ShortTimeFourierTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFourierTransform</span></code></a> class. Both the
calculation of the short-time Fourier transform and the covariance matrix
can run in parallel depending on the available resources. Depending on the
averaging size and frequency content, the covariance matrix can have a
different shape:</p>
<ul class="simple">
<li><p>Shape is <code class="docutils literal notranslate"><span class="pre">(n_traces,</span> <span class="pre">n_traces)</span></code> if a single frequency and time window
is given. This configuration is also obtained when slicing or reducing a
covariance matrix object.</p></li>
<li><p>Shape is <code class="docutils literal notranslate"><span class="pre">(n_frequencies,</span> <span class="pre">n_traces,</span> <span class="pre">n_traces)</span></code> if only one time frame
is given, for <code class="docutils literal notranslate"><span class="pre">n_frequencies</span></code> frequencies, which depends on the window
size and sampling rate.</p></li>
<li><p>Shape is <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span> <span class="pre">n_traces,</span> <span class="pre">n_traces)</span></code> if multiple
time frames are given.</p></li>
</ul>
<p>All the methods defined in the the
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> class are performed on
the flattened array with the
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.flat" title="covseisnet.covariance.CovarianceMatrix.flat"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flat()</span></code></a> method, which allow
to obtain as many <span class="math notranslate nohighlight">\(N \times N\)</span> covariance matrices as time and
frequency samples.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> class is rarely meant
to be instantiated directly. It should most often be obtained from the
output of the <a class="reference internal" href="#covseisnet.covariance.calculate_covariance_matrix" title="covseisnet.covariance.calculate_covariance_matrix"><code class="xref py py-func docutils literal notranslate"><span class="pre">calculate_covariance_matrix()</span></code></a>
function as in the following example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">csn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">NetworkStream</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">time</span><span class="p">,</span> <span class="n">frequency</span><span class="p">,</span> <span class="n">covariance</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">calculate_covariance_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stream</span><span class="p">,</span> <span class="n">window_duration</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mi">10</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">covariance</span><span class="p">))</span>
<span class="go">&lt;class &#39;covseisnet.covariance.CovarianceMatrix&#39;&gt;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If for some reason you need to create a
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> object from a numpy
array, you have the several solutions provided by the <a class="reference external" href="https://numpy.org/doc/stable/user/basics.subclassing.html#subclassing-ndarray">numpy
subclassing mechanism</a>.
We recommend using the contructor of the class, which allows to pass
the stats and stft attributes, as in the following example:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">csn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">covariance</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),</span> <span class="n">stats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stft</span><span class="o">=</span><span class="kc">None</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">covariance</span>
<span class="go">CovarianceMatrix([[ 0.,  0.,  0.,  0.],</span>
<span class="go">                  [ 0.,  0.,  0.,  0.],</span>
<span class="go">                  [ 0.,  0.,  0.,  0.],</span>
<span class="go">                  [ 0.,  0.,  0.,  0.]])</span>
</pre></div>
</div>
<p>In that case, the covariance matrix object passes through several
tests such as the Hermitian property of the two last dimensions, and
the number of dimensions of the input array. If the input array does
not pass the tests, a ValueError is raised. The input array can be any
array-like object, as it is passed to the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.asarray.html#numpy.asarray" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.asarray()</span></code></a>
function, which also allow to turn the input array into a
complex-valued numpy array. The input array is then cast into a
CovarianceMatrix object with the <a class="reference external" href="https://numpy.org/doc/stable/user/basics.subclassing.html#view-casting">view casting mechanism of numpy</a>,
and the attributes stats and stft are added to the object. You can
also directly employ the view method of the numpy array, but you will
have to set the stats and stft attributes manually.</p>
</div>
<dl class="py method">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.coherence">
<span class="sig-name descname"><span class="pre">coherence</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'spectral_width'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1e-10</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix.coherence"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.coherence" title="Link to this definition">#</a></dt>
<dd><p>Covariance-based coherence estimation.</p>
<p>The coherence is obtained from each covariance matrix eigenvalue
distribution, calculated with the
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues" title="covseisnet.covariance.CovarianceMatrix.eigenvalues"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eigenvalues()</span></code></a> method.
For a given matrix <span class="math notranslate nohighlight">\(\mathbf{C} \in \mathbb{C}^{N \times N}\)</span>, we
obtain the eigenvalues <span class="math notranslate nohighlight">\(\boldsymbol{\lambda} =
\{\lambda_i\}_{i=1\ldots N}\)</span>, with <span class="math notranslate nohighlight">\(\lambda_i \in [0, 1]\)</span>
normalized by the sum of the eigenvalues. The coherence is obtained
from <span class="math notranslate nohighlight">\(c = f(\boldsymbol{\lambda})\)</span>, with <span class="math notranslate nohighlight">\(f\)</span> being defined
by the <code class="docutils literal notranslate"><span class="pre">kind</span></code> parameter:</p>
<ul>
<li><p>The spectral width is obtained with setting
<code class="docutils literal notranslate"><span class="pre">kind=&quot;spectral_width&quot;</span></code> , and returns the width <span class="math notranslate nohighlight">\(\sigma\)</span> of
the eigenvalue distribution (obtained at each time and frequency)
such as</p>
<div class="math notranslate nohighlight">
\[\sigma = \sum_{i=0}^n i \lambda_i\]</div>
</li>
<li><p>The entropy is obtained with setting <code class="docutils literal notranslate"><span class="pre">kind=&quot;entropy&quot;</span></code>, and returns
the entropy <span class="math notranslate nohighlight">\(h\)</span> of the eigenvalue distribution (obtained at
each time and frequency) such as</p>
<div class="math notranslate nohighlight">
\[h = - \sum_{i=0}^n i \lambda_i \log(\lambda_i + \epsilon)\]</div>
</li>
<li><p>The Shanon diversity index is obtained with setting
<code class="docutils literal notranslate"><span class="pre">kind=&quot;diversity&quot;</span></code>, and returns the diversity index <span class="math notranslate nohighlight">\(D\)</span> of
the eigenvalue distribution (obtained at each time and frequency)
such as the exponential of the entropy:</p>
<div class="math notranslate nohighlight">
\[D = \exp(h + \epsilon)\]</div>
</li>
</ul>
<p>In each case, <span class="math notranslate nohighlight">\(\epsilon\)</span> is a regularization parameter to avoid
the logarithm of zero. The coherence is calculated for each time and
frequency sample (if any), and the result is a coherence matrix of
maximal shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies)</span></code>. The <span class="math notranslate nohighlight">\(\log\)</span> and
<span class="math notranslate nohighlight">\(\exp\)</span> functions are the natural logarithm and exponential.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <em>optional</em>) -- The type of coherence, may be &quot;spectral_width&quot; (default),
&quot;entropy&quot;, or &quot;diversity&quot;.</p></li>
<li><p><strong>epsilon</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <em>optional</em>) -- The regularization parameter for the logarithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> -- The coherence of maximal shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies)</span></code>,
depending on the input covariance matrix shape.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> -- If the covariance matrix is not Hermitian.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues" title="covseisnet.covariance.CovarianceMatrix.eigenvalues"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eigenvalues()</span></code></a></p>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.eigenvalues">
<span class="sig-name descname"><span class="pre">eigenvalues</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">norm:</span> <span class="pre">~typing.Callable</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">max&gt;</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a></span></span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix.eigenvalues"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues" title="Link to this definition">#</a></dt>
<dd><p>Eigenvalue decomposition.</p>
<p>Given and Hermitian matrix <span class="math notranslate nohighlight">\(\mathbf{C} \in \mathbb{C}^{N \times
N}\)</span>, the eigenvalue decomposition is defined as</p>
<div class="math notranslate nohighlight">
\[\mathbf{C} = \mathbf{U D U}^\dagger\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{U} \in \mathbb{C}^{N \times N}\)</span> is the unitary
matrix of eigenvectors (which are not calculated here, see
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.eigenvectors" title="covseisnet.covariance.CovarianceMatrix.eigenvectors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eigenvectors()</span></code></a> for this
purpose), <span class="math notranslate nohighlight">\(\mathbf{U}^\dagger\)</span> is the conjugate transpose of
<span class="math notranslate nohighlight">\(\mathbf{U}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{D} \in \mathbb{R}^{N \times N}\)</span>
is a diagonal matrix of eigenvalues, as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\mathbf{D} = \pmatrix{\lambda_1 &amp; 0 &amp; \cdots &amp; 0 \\
                0 &amp; \lambda_2 &amp; \cdots &amp; 0 \\ \vdots &amp; \vdots &amp;
                \ddots &amp; \vdots \\ 0 &amp; 0 &amp; \cdots &amp; \lambda_N}\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(\lambda_i\)</span> the eigenvalues. For convenience, the
eigenvalues are returned as a vector such as</p>
<div class="math notranslate nohighlight">
\[\boldsymbol\lambda = \pmatrix{\lambda_1, \lambda_2, \ldots,
\lambda_N}\]</div>
<p>The eigenvalues are sorted in decreasing order and normalized by the
maximum eigenvalue by default, but can be normalized by any function
provided by numpy. Since the matrix <span class="math notranslate nohighlight">\(\mathbf{C}\)</span> is Hermitian by
definition, the eigenvalues are real- and positive-valued. Also, the
eigenvectors are orthogonal and normalized.</p>
<p>The eigenvalue decomposition is performed onto the two last dimensions
of the <a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> object. The
function used for eigenvalue decomposition is
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.eigvalsh.html#numpy.linalg.eigvalsh" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.linalg.eigvalsh()</span></code></a>. It sassumes that the input matrix is 2D
and hermitian, so the decomposition is performed onto the lower
triangular part to save time.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>norm</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">function</span></code>, <em>optional</em>) -- The function used to normalize the eigenvalues. Can be
<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.max.html#numpy.max" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.max()</span></code></a>, (default), any other functions provided by
numpy, or a custom function. Note that the function must accept
the <code class="docutils literal notranslate"><span class="pre">axis</span></code> keyword argument.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> -- The eigenvalues of maximal shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span>
<span class="pre">n_stations)</span></code>.</p>
</dd>
</dl>
<div class="admonition-notes admonition">
<p class="admonition-title">Notes</p>
<p>The eigenvalue decomposition is performed onto the two last dimensions
of the <a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> object. The
matrices are first flattened with the
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.flat" title="covseisnet.covariance.CovarianceMatrix.flat"><code class="xref py py-meth docutils literal notranslate"><span class="pre">flat()</span></code></a> method, so the
eigenvalues are calculated for each time and frequency sample. The
eigenvalues are sorted in decreasing order, and normalized by the
maximum eigenvalue by default, before being reshaped to the original
shape of the covariance matrix. This maximizes the performance of the
eigenvalue decomposition.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.eigenvectors" title="covseisnet.covariance.CovarianceMatrix.eigenvectors"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eigenvectors()</span></code></a>, <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.eigvalsh.html#numpy.linalg.eigvalsh" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.linalg.eigvalsh()</span></code></a></p>
</div>
<p class="rubric">Examples</p>
<p>Calculate the eigenvalues of the example covariance matrix:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">cn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cov</span> <span class="o">@</span> <span class="n">cov</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">conj</span><span class="p">()</span> <span class="k">for</span> <span class="n">cov</span> <span class="ow">in</span> <span class="n">cov</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">()</span>
<span class="go">    array([[1.        , 0.14577012, 0.02521345],</span>
<span class="go">           [1.        , 0.13510247, 0.00369051],</span>
<span class="go">           [1.        , 0.22129766, 0.0148769 ]])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.eigenvectors">
<span class="sig-name descname"><span class="pre">eigenvectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rank</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><span class="pre">tuple</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#slice" title="(in Python v3.13)"><span class="pre">slice</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_covariance</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><span class="pre">CovarianceMatrix</span></a></span></span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix.eigenvectors"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.eigenvectors" title="Link to this definition">#</a></dt>
<dd><p>Extract eigenvectors of given rank.</p>
<p>Given a Hermitian matrix <span class="math notranslate nohighlight">\(\mathbf{C} \in \mathbb{C}^{N \times
N}\)</span>, the eigenvector decomposition is defined as</p>
<div class="math notranslate nohighlight">
\[\mathbf{C} = \mathbf{U D U}^\dagger\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathbf{U} \in \mathbb{C}^{N \times N}\)</span> is the unitary
matrix of eigenvectors, <span class="math notranslate nohighlight">\(\mathbf{U}^\dagger\)</span> is the conjugate
transpose of <span class="math notranslate nohighlight">\(\mathbf{U}\)</span>, and <span class="math notranslate nohighlight">\(\mathbf{D} \in
\mathbb{R}^{N \times N}\)</span> is a diagonal matrix of eigenvalues. The
eigenvectors are normalized and orthogonal, and the eigenvalues are
real- and positive-valued. The eigenvectors are returned as a matrix</p>
<div class="math notranslate nohighlight">
\[\mathbf{U} = \pmatrix{\mathbf{u}_1, \mathbf{u}_2, \ldots,
\mathbf{u}_R}\]</div>
<p>with <span class="math notranslate nohighlight">\(\mathbf{v}_i\)</span> the eigenvectors, and <span class="math notranslate nohighlight">\(R\)</span> the maximum
rank of the eigenvectors. The eigenvectors are sorted in decreasing
order of the eigenvalues, and the eigenvectors are normalized. The
function used for extracting eigenvectors is
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.eigh.html#scipy.linalg.eigh" title="(in SciPy v1.14.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.linalg.eigh()</span></code></a>. It assumes that the input matrix is 2D and
hermitian, so the decomposition is performed onto the lower triangular
part.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">covariance</span></code> parameter is set to False (default), the
eigenvectors are returned as a matrix of shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span>
<span class="pre">n_frequencies,</span> <span class="pre">n_stations,</span> <span class="pre">rank)</span></code> if the parameter <code class="docutils literal notranslate"><span class="pre">covariance</span></code> is
<code class="docutils literal notranslate"><span class="pre">False</span></code>, else <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span> <span class="pre">n_stations,</span> <span class="pre">n_stations)</span></code>,
resulting from the outer product of the eigenvectors.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">covariance</span></code> parameter is set to True, the return value is a
covariance matrix object with the outer product of the eigenvectors
multiplied by the given weights <span class="math notranslate nohighlight">\(\mathbf{w} \in \mathbb{R}^{R}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\tilde{\mathbf{C}} = \sum_{i=1}^R w_i \mathbf{u}_i
\mathbf{u}_i^\dagger\]</div>
<p>The weights are the eigenvalues of the covariance matrix if
<code class="docutils literal notranslate"><span class="pre">weights</span></code> is None (default), else the weights are the input weights.
The weights are used to scale the eigenvectors before the outer
product. In particular, if the weights are zeros and ones, this
function can be used to apply spatial whitening to the covariance
matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rank</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#slice" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">slice</span></code></a>, or <a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">None</span></code></a>, <em>optional</em>) -- The rank of the eigenvectors. If None, all eigenvectors are
returned. If a tuple or slice, the eigenvectors are sliced
according to the tuple or slice. If an integer is given, the
eigenvectors are sliced according to the integer. Default is None.</p></li>
<li><p><strong>return_covariance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>, <em>optional</em>) -- If True, the outer product of the eigenvectors is returned as a
covariance matrix object. Default is False.</p></li>
<li><p><strong>weights</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a>, <em>optional</em>) -- The weights used to scale the eigenvectors before the outer
product. If None, the eigenvalues are used as weights. Default is
None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">covseisnet.covariance.CovarianceMatrix</span></code></a> -- The complex-valued eigenvector array of shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span>
<span class="pre">n_frequencies,</span> <span class="pre">n_stations,</span> <span class="pre">rank)</span></code> if <code class="docutils literal notranslate"><span class="pre">covariance</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>,
else <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span> <span class="pre">n_stations,</span> <span class="pre">n_stations)</span></code>.</p>
</dd>
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.13)"><strong>ValueError</strong></a> -- If the covariance matrix is not Hermitian.</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues" title="covseisnet.covariance.CovarianceMatrix.eigenvalues"><code class="xref py py-meth docutils literal notranslate"><span class="pre">eigenvalues()</span></code></a>, <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.linalg.eigh.html#scipy.linalg.eigh" title="(in SciPy v1.14.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">scipy.linalg.eigh()</span></code></a></p>
</div>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.flat">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">flat</span></span><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.flat" title="Link to this definition">#</a></dt>
<dd><p>Covariance matrices with flatten first dimensions.</p>
<p>The shape of the covariance matrix depend on the number of time
windows and frequencies. The property
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.flat" title="covseisnet.covariance.CovarianceMatrix.flat"><code class="xref py py-attr docutils literal notranslate"><span class="pre">flat</span></code></a> allows to obtain
as many <span class="math notranslate nohighlight">\(N \times N\)</span> covariance matrices as time and frequency
samples.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">np.ndarray</span></code> -- The covariance matrices in a shape <code class="docutils literal notranslate"><span class="pre">(n_times</span> <span class="pre">*</span> <span class="pre">n_frequencies,</span>
<span class="pre">n_traces,</span> <span class="pre">n_traces)</span></code>.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">csn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span><span class="o">.</span><span class="n">shape</span>
<span class="go">    (5, 4, 2, 2)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="o">.</span><span class="n">flat</span><span class="o">.</span><span class="n">shape</span>
<span class="go">    (20, 2, 2)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.triu">
<span class="sig-name descname"><span class="pre">triu</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix.triu"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.triu" title="Link to this definition">#</a></dt>
<dd><p>Extract upper triangular matrices.</p>
<p>This method is useful when calculating the cross-correlation matrix
associated with the covariance matrix. Indeed, since the covariance
matrix is Hermitian, the cross-correlation matrix is symmetric, so
there is no need to calculate the lower triangular part.</p>
<p>The method <a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.triu" title="covseisnet.covariance.CovarianceMatrix.triu"><code class="xref py py-meth docutils literal notranslate"><span class="pre">triu()</span></code></a> is
applied to the flattened array, then reshaped to the original shape of
the covariance matrix. The last dimension of the returned matrix is
the number of upper triangular elements of the covariance matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <em>optional</em>) -- Keyword arguments passed to the <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.triu_indices.html#numpy.triu_indices" title="(in NumPy v2.1)"><code class="xref py py-func docutils literal notranslate"><span class="pre">numpy.triu_indices()</span></code></a>
function.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> -- The upper triangular part of the covariance matrix, with a maximum
shape of <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span> <span class="pre">n_traces</span> <span class="pre">*</span> <span class="pre">(n_traces</span> <span class="pre">+</span> <span class="pre">1)</span> <span class="pre">//</span>
<span class="pre">2)</span></code>.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">csn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">CovarianceMatrix</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">cov</span><span class="o">.</span><span class="n">triu</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span>
<span class="go">    (5, 4, 3)</span>
</pre></div>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.twosided">
<span class="sig-name descname"><span class="pre">twosided</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axis</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">-3</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><span class="pre">CovarianceMatrix</span></a></span></span><a class="reference internal" href="_modules/covseisnet/covariance.html#CovarianceMatrix.twosided"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.twosided" title="Link to this definition">#</a></dt>
<dd><p>Get the full covariance spectrum.</p>
<p>Given that the covariance matrix is Hermitian, the full covariance
matrix can be obtained by filling the negative frequencies with the
complex conjugate of the positive frequencies. The method
<a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix.twosided" title="covseisnet.covariance.CovarianceMatrix.twosided"><code class="xref py py-meth docutils literal notranslate"><span class="pre">twosided()</span></code></a> performs this
operation.</p>
<p>The frequency axis is assumed to be the second axis of the covariance
matrix. The function returns a new covariance matrix with the negative
frequencies filled with the complex conjugate of the positive
frequencies.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>axis</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <em>optional</em>) -- The frequency axis of the covariance matrix. Default is -3.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> -- The full covariance matrix.</p>
</dd>
</dl>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="covseisnet.covariance.CovarianceMatrix.is_hermitian">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">is_hermitian</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><span class="pre">bool</span></a></em><a class="headerlink" href="#covseisnet.covariance.CovarianceMatrix.is_hermitian" title="Link to this definition">#</a></dt>
<dd><p>Check if the covariance matrix is Hermitian.</p>
<p>Given a covariance matrix <span class="math notranslate nohighlight">\(\mathbf{C} \in \mathbb{C}^{N \times
N}\)</span>, the matrix is Hermitian if the matrix is equal to its conjugate
transpose, that is</p>
<div class="math notranslate nohighlight">
\[\mathbf{C} = \mathbf{C}^\dagger\]</div>
<p>to some extent provided by the <code class="docutils literal notranslate"><span class="pre">tol</span></code> parameter. This check is
performed on all the covariance matrices of the object, e.g., for each
time and frequency sample if any.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>tol</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">float</span></code></a>, <em>optional</em>) -- The tolerance for the comparison.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a> -- True if the covariance matrix is Hermitian, False otherwise.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="covseisnet.covariance.calculate_covariance_matrix">
<span class="sig-prename descclassname"><span class="pre">covseisnet.covariance.</span></span><span class="sig-name descname"><span class="pre">calculate_covariance_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stream</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="stream.html#covseisnet.stream.NetworkStream" title="covseisnet.stream.NetworkStream"><span class="pre">NetworkStream</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">window_duration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.13)"><span class="pre">float</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">average</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">average_step</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.13)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">whiten</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><span class="pre">str</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'none'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.13)"><span class="pre">tuple</span></a><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><span class="pre">ndarray</span></a><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><span class="pre">CovarianceMatrix</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="reference internal" href="_modules/covseisnet/covariance.html#calculate_covariance_matrix"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#covseisnet.covariance.calculate_covariance_matrix" title="Link to this definition">#</a></dt>
<dd><p>Calculate covariance matrix.</p>
<p>The covariance matrix is calculated from the Fourier transform of the
input stream. The covariance matrix is calculated for each time window and
frequency, and averaged over a given number of windows. Please refer to
the <a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> class, rubric
<strong>Mathematical definition</strong> for a detailed explanation of the covariance
matrix. You may also refer to the paper <a class="footnote-reference brackets" href="#footcite-seydoux-detecting-2016" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>
for deeper insights.</p>
<p class="rubric">Covariance-level whitening</p>
<p>The whitening parameter can be used to normalize the covariance matrix
directly, in addition to the trace-level whitening implementation in the
<a class="reference internal" href="stream.html#covseisnet.stream.NetworkStream.whiten" title="covseisnet.stream.NetworkStream.whiten"><code class="xref py py-meth docutils literal notranslate"><span class="pre">covseisnet.stream.NetworkStream.whiten()</span></code></a> method. The parameter can
be set to &quot;none&quot; (default), &quot;slice&quot;, or &quot;window&quot;. The &quot;none&quot; option does
not apply any whitening to the covariance matrix. The &quot;slice&quot; option
normalizes the spectra <span class="math notranslate nohighlight">\(u_{i,m}(f)\)</span> by the mean of the absolute
value of the spectra within the same group of time windows
<span class="math notranslate nohighlight">\(\{\tau_m\}_{m=1}^M\)</span>, so that</p>
<div class="math notranslate nohighlight">
\[u_{i,m}(f) = \frac{u_{i,m}(f)}{\sum_{i=1}^M |u_{i,m}(f)|}\]</div>
<p>The &quot;window&quot; option normalizes the spectra <span class="math notranslate nohighlight">\(u_{i,m}(f)\)</span> by the
absolute value of the spectra within the same time window <span class="math notranslate nohighlight">\(\tau_m\)</span>
so that</p>
<div class="math notranslate nohighlight">
\[u_{i,m}(f) = \frac{u_{i,m}(f)}{|u_{i,m}(f)|}\]</div>
<p>These additional whitening methods can be used in addition to the
trave-level <a class="reference internal" href="stream.html#covseisnet.stream.NetworkStream.whiten" title="covseisnet.stream.NetworkStream.whiten"><code class="xref py py-meth docutils literal notranslate"><span class="pre">whiten()</span></code></a> method to
further whiten the covariance matrix.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stream</strong> (<a class="reference internal" href="stream.html#covseisnet.stream.NetworkStream" title="covseisnet.stream.NetworkStream"><code class="xref py py-class docutils literal notranslate"><span class="pre">NetworkStream</span></code></a>) -- The input data stream.</p></li>
<li><p><strong>average</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>) -- The number of window used to estimate the sample covariance.</p></li>
<li><p><strong>average_step</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>, <em>optional</em>) -- The sliding window step for covariance matrix calculation (in number
of windows).</p></li>
<li><p><strong>whiten</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <em>optional</em>) -- The type of whitening applied to the covariance matrix. Can be &quot;none&quot;
(default), &quot;slice&quot;, or &quot;window&quot;. This parameter can be used in
addition to the <a class="reference internal" href="stream.html#covseisnet.stream.NetworkStream.whiten" title="covseisnet.stream.NetworkStream.whiten"><code class="xref py py-meth docutils literal notranslate"><span class="pre">whiten()</span></code></a> method
to further whiten the covariance matrix.</p></li>
<li><p><strong>**kwargs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.13)"><code class="xref py py-class docutils literal notranslate"><span class="pre">dict</span></code></a>, <em>optional</em>) -- Additional keyword arguments passed to the
<a class="reference internal" href="signal.html#covseisnet.signal.ShortTimeFourierTransform" title="covseisnet.signal.ShortTimeFourierTransform"><code class="xref py py-class docutils literal notranslate"><span class="pre">ShortTimeFourierTransform</span></code></a> class.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> -- The time vector of the beginning of each covariance window, expressed
in matplotlib time.</p></li>
<li><p><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.1)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numpy.ndarray</span></code></a> -- The frequency vector.</p></li>
<li><p><a class="reference internal" href="#covseisnet.covariance.CovarianceMatrix" title="covseisnet.covariance.CovarianceMatrix"><code class="xref py py-class docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a> -- The complex covariance matrix, with a shape depending on the number of
time windows and frequencies, maximum shape <code class="docutils literal notranslate"><span class="pre">(n_times,</span> <span class="pre">n_frequencies,</span>
<span class="pre">n_traces,</span> <span class="pre">n_traces)</span></code>.</p></li>
</ul>
</p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>Calculate the covariance matrix of the example stream with 1 second
windows averaged over 5 windows:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">covseisnet</span> <span class="k">as</span> <span class="nn">csn</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">stream</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">calculate_covariance_matrix</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">stream</span><span class="p">,</span> <span class="n">window_duration_sec</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mi">5</span>
<span class="gp">... </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">    (27, 51, 3, 3)</span>
</pre></div>
</div>
<p class="rubric">References</p>
<div class="docutils container" id="id2">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-seydoux-detecting-2016" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Lonard Seydoux, NikolaiM. Shapiro, Julien DeRosny, Florent Brenguier, and Matthieu Lands. Detecting seismic activity with a covariance matrix analysis of data recorded on seismic arrays. <em>Geophysical Journal International</em>, 204(3):14301442, March 2016. URL: <a class="reference external" href="https://academic.oup.com/gji/article-lookup/doi/10.1093/gji/ggv531">https://academic.oup.com/gji/article-lookup/doi/10.1093/gji/ggv531</a>, <a class="reference external" href="https://doi.org/10.1093/gji/ggv531">doi:10.1093/gji/ggv531</a>.</p>
</aside>
</aside>
</div>
</dd></dl>

</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="signal.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Signal processing</p>
      </div>
    </a>
    <a class="right-next"
       href="correlation.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Cross-correlation matrix</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix</span></code></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.coherence"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.coherence()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.eigenvalues"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.eigenvalues()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.eigenvectors"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.eigenvectors()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.flat"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.flat</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.triu"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.triu()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.twosided"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.twosided()</span></code></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.CovarianceMatrix.is_hermitian"><code class="docutils literal notranslate"><span class="pre">CovarianceMatrix.is_hermitian</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#covseisnet.covariance.calculate_covariance_matrix"><code class="docutils literal notranslate"><span class="pre">calculate_covariance_matrix()</span></code></a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Lonard Seydoux, Jean Soubestre, Cyril Journeau, Francis Tong & Nikolai Shapiro
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2022, The Covseisnet Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>