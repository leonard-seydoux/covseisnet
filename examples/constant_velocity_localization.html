
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Locating events within a constant velocity model &#8212; covseisnet</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=02ec9fb4" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-gallery.css?v=26227f6e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=f9c1cefe"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/constant_velocity_localization';</script>
    <link rel="icon" href="../_static/logo_covseisnet_small.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials.html" />
    <link rel="prev" title="Constant differential times" href="constant_velocity_travel_times.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo_covseisnet_normal.svg" class="logo__image only-light" alt="Covseisnet logo"/>
    <img src="../_static/logo_covseisnet_normal.svg" class="logo__image only-dark pst-js-only" alt="Covseisnet logo"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Home
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../examples.html">Examples</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="synchronization.html">Synchronization</a></li>
<li class="toctree-l2"><a class="reference internal" href="normalization.html">Time normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="whitening.html">Spectral whitening</a></li>
<li class="toctree-l2"><a class="reference internal" href="coherence.html">Spatial coherence</a></li>
<li class="toctree-l2"><a class="reference internal" href="coherence_preprocess.html">Coherence preprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="correlation.html">Cross-correlation</a></li>
<li class="toctree-l2"><a class="reference internal" href="constant_velocity_model.html">Constant velocity travel times</a></li>
<li class="toctree-l2"><a class="reference internal" href="constant_velocity_travel_times.html">Constant differential times</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Locating events within a constant velocity model</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/01_introduction.html">1. Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/02_covariance.html">2. Coherence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/03_correlation.html">3. Correlations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/04_calculate_travel_times.html">4. Travel times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/05_localization.html">5. Localization</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../stream.html">Network stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../signal.html">Signal processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../covariance.html">Covariance Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../correlation.html">Cross-correlation matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plot.html">Plotting tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../data.html">Data management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../spatial.html">Geographical and spatial functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../velocity.html">Velocity models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../travel_times.html">Travel times</a></li>
<li class="toctree-l2"><a class="reference internal" href="../backprojection.html">Backprojection</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/leonard-seydoux/covseisnet" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/leonard-seydoux/covseisnet/issues/new?title=Issue%20on%20page%20%2Fexamples/constant_velocity_localization.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Locating events within a constant velocity model</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Load-seismograms">Load seismograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Station-and-source-coordinates">Station and source coordinates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Evaluate-covariance-matrix">Evaluate covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Evaluate-the-pairwise-cross-correlation-functions">Evaluate the pairwise cross-correlation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Calculate-travel-times">Calculate travel times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Locate-the-source-with-backprojection">Locate the source with backprojection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Compare-maximum-likelihood-with-known-source-location">Compare maximum likelihood with known source location</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="Locating-events-within-a-constant-velocity-model">
<h1>Locating events within a constant velocity model<a class="headerlink" href="#Locating-events-within-a-constant-velocity-model" title="Link to this heading">#</a></h1>
<p>This example shows how to calculate the differential travel times of seismic waves in a constant velocity model between two receivers. We first define the model and the sources and receivers coordinates. We then calculate the travel times for each receiver using the class <code class="docutils literal notranslate"><span class="pre">covseisnet.travel_times.TravelTimes</span></code>, and we calculate the differential travel times using the class <code class="docutils literal notranslate"><span class="pre">covseisnet.travel_times.DifferentialTravelTimes</span></code>. Finally, we locate the source of the seismic waves using the class
<code class="docutils literal notranslate"><span class="pre">covseisnet.backprojection.DifferentialBackProjection</span></code> and plot the results on a map.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="kn">import</span> <span class="n">PlateCarree</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">covseisnet</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">csn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">covseisnet.travel_times</span><span class="w"> </span><span class="kn">import</span> <span class="n">TravelTimes</span><span class="p">,</span> <span class="n">DifferentialTravelTimes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">covseisnet.backprojection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DifferentialBackProjection</span>
</pre></div>
</div>
</div>
<section id="Load-seismograms">
<h2>Load seismograms<a class="headerlink" href="#Load-seismograms" title="Link to this heading">#</a></h2>
<p>We first load the seismograms from the example data set. We downloaded the seismogram from the Wilber 3 interface, <a class="reference external" href="https://ds.iris.edu/wilber3/data_request/leonard-seydoux/2020-10-05-mb44-aegean-sea-1" rel="noopener noreferrer" target="_blank">archived at this link</a>. These seismograms contains the record of the Mb 4.4 earthquake that occurred in the Aegean Sea on October 5, 2020 at 14:57:51 UTC at 39.9°N, 23.3° E and 10 km depth.</p>
<p>We also pre-process the seismograms by merging overlapping traces, removing the linear trend, filtering the data with a high-pass filter with a corner frequency of 0.01 Hz, and synchronizing the traces, as shown in the other examples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load seismograms</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">NetworkStream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s2">&quot;data/aegean_sea_example.mseed&quot;</span><span class="p">)</span>

<span class="c1"># Pre-process</span>
<span class="n">stream</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">detrend</span><span class="p">(</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="s2">&quot;highpass&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Station-and-source-coordinates">
<h2>Station and source coordinates<a class="headerlink" href="#Station-and-source-coordinates" title="Link to this heading">#</a></h2>
<p>We associate the coordinates of the different stations to the corresponding seismograms. We first download the inventory of the seismograms from the National Observatory of Athens (NOA) data center. We then associate the coordinates to the seismograms using the method :func:<code class="docutils literal notranslate"><span class="pre">~covseisnet.stream.Stream.assign_coordinates</span></code>. The :class:<code class="docutils literal notranslate"><span class="pre">obspy.Inventory</span></code> object is then used to plot the stations on a map.</p>
<p>We also add the known source coordinates of the earthquake to the map, to compare the location of the earthquake with the location of the backprojection results.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get inventory to assign station coordinates</span>
<span class="n">inventory</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">download_inventory</span><span class="p">(</span><span class="n">datacenter</span><span class="o">=</span><span class="s2">&quot;NOA&quot;</span><span class="p">)</span>
<span class="n">stream</span><span class="o">.</span><span class="n">assign_coordinates</span><span class="p">(</span><span class="n">inventory</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>

<span class="c1"># Plot source coordinates</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="mf">23.3465</span><span class="p">,</span> <span class="mf">39.8812</span><span class="p">,</span> <span class="mi">10</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">source_location</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;k*&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="c1"># Extract natural extent for later use</span>
<span class="n">extent</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_extent</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">PlateCarree</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_constant_velocity_localization_5_0.png" src="../_images/examples_constant_velocity_localization_5_0.png" />
</div>
</div>
</section>
<section id="Evaluate-covariance-matrix">
<h2>Evaluate covariance matrix<a class="headerlink" href="#Evaluate-covariance-matrix" title="Link to this heading">#</a></h2>
<p>We calculate the covariance matrix of the seismograms using the method :func:<code class="docutils literal notranslate"><span class="pre">~covseisnet.covariance.calculate_covariance_matrix</span></code>. We use a window duration of 200 s, which allow for the slowest possible seismic waves to propagate between the stations (overestimating the travel time). We average the covariance matrix over 5 windows, which results in a single time window.</p>
<p>In this specific case, the coherence is a function of the frequency only. We observe the earthquake-related signal induces a strong wavefield coherence (that is, a low spectral width) between 1 and 10 Hz in particular.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute covariance matrix</span>
<span class="n">times</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">covariances</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">covariance</span><span class="o">.</span><span class="n">calculate_covariance_matrix</span><span class="p">(</span>
    <span class="n">stream</span><span class="p">,</span> <span class="n">window_duration</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">whiten</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
<span class="p">)</span>

<span class="c1"># Calculate coherence</span>
<span class="n">coherence</span> <span class="o">=</span> <span class="n">covariances</span><span class="o">.</span><span class="n">coherence</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;spectral_width&quot;</span><span class="p">)</span>

<span class="c1"># Show</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">coherence</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Covariance matrix spectral width&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_constant_velocity_localization_7_0.png" src="../_images/examples_constant_velocity_localization_7_0.png" />
</div>
</div>
</section>
<section id="Evaluate-the-pairwise-cross-correlation-functions">
<h2>Evaluate the pairwise cross-correlation functions<a class="headerlink" href="#Evaluate-the-pairwise-cross-correlation-functions" title="Link to this heading">#</a></h2>
<p>We calculate the pairwise cross-correlation functions between the seismograms using the method :func:<code class="docutils literal notranslate"><span class="pre">~covseisnet.correlation.calculate_cross_correlation_matrix</span></code>. We exclude the autocorrelation functions from the calculation, as they are not useful for the backprojection.</p>
<p>We also pre-process the cross-correlation functions by tapering the edges of the functions, bandpass filtering the data between 1 and 5 Hz, calculating the envelope of the data, and smoothing the data with a Gaussian filter with a standard deviation of 30 samples. Finally, we normalize the data by the maximum value of each cross-correlation function.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate cross-correlation functions</span>
<span class="n">lags</span><span class="p">,</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">correlations</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">correlation</span><span class="o">.</span><span class="n">calculate_cross_correlation_matrix</span><span class="p">(</span>
    <span class="n">covariances</span><span class="p">,</span> <span class="n">include_autocorrelation</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>


<span class="c1"># Pre-process the cross-correlation functions</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">taper</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">bandpass</span><span class="p">(</span><span class="n">frequency_band</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">envelope</span><span class="p">()</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">smooth</span><span class="p">(</span><span class="n">sigma</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">correlations</span> <span class="o">/=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">correlations</span> <span class="o">=</span> <span class="n">correlations</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Calculate-travel-times">
<h2>Calculate travel times<a class="headerlink" href="#Calculate-travel-times" title="Link to this heading">#</a></h2>
<p>We calculate the travel times of the seismic waves between the stations using the class :class:<code class="docutils literal notranslate"><span class="pre">~covseisnet.travel_times.TravelTimes</span></code>. We use a constant velocity model with a velocity of 3.5 km/s, assuming that the S-waves will dominate the seismic records. We then calculate the differential travel times between the stations using the class :class:<code class="docutils literal notranslate"><span class="pre">~covseisnet.travel_times.DifferentialTravelTimes</span></code>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define the velocity model</span>
<span class="n">extent_with_depth</span> <span class="o">=</span> <span class="n">extent</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">velocity</span><span class="o">.</span><span class="n">VelocityModel</span><span class="p">(</span>
    <span class="n">extent</span><span class="o">=</span><span class="n">extent_with_depth</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">velocity</span><span class="o">=</span><span class="mf">3.5</span>
<span class="p">)</span>

<span class="c1"># Obtain the travel times</span>
<span class="n">travel_times</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">station</span><span class="p">:</span> <span class="n">TravelTimes</span><span class="p">(</span><span class="n">stats</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">stats</span><span class="p">,</span> <span class="n">velocity_model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">stream</span>
<span class="p">}</span>

<span class="c1"># Calculate differential travel times</span>
<span class="n">differential_travel_times</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
    <span class="n">station_1</span><span class="p">,</span> <span class="n">station_2</span> <span class="o">=</span> <span class="n">pair</span>
    <span class="n">differential_travel_times</span><span class="p">[</span><span class="n">pair</span><span class="p">]</span> <span class="o">=</span> <span class="n">DifferentialTravelTimes</span><span class="p">(</span>
        <span class="n">travel_times</span><span class="p">[</span><span class="n">station_1</span><span class="p">],</span>
        <span class="n">travel_times</span><span class="p">[</span><span class="n">station_2</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Locate-the-source-with-backprojection">
<h2>Locate the source with backprojection<a class="headerlink" href="#Locate-the-source-with-backprojection" title="Link to this heading">#</a></h2>
<p>We locate the source of the seismic waves using the class :class:<code class="docutils literal notranslate"><span class="pre">~covseisnet.backprojection.DifferentialBackProjection</span></code>. We use the differential travel times calculated previously and the pre-processed cross-correlation functions. We calculate the likelihood of the source location using the method :func:<code class="docutils literal notranslate"><span class="pre">~covseisnet.backprojection.DifferentialBackProjection.calculate_likelihood</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate likelihood</span>
<span class="n">backprojection</span> <span class="o">=</span> <span class="n">DifferentialBackProjection</span><span class="p">(</span><span class="n">differential_travel_times</span><span class="p">)</span>
<span class="n">backprojection</span><span class="o">.</span><span class="n">calculate_likelihood</span><span class="p">(</span><span class="n">cross_correlation</span><span class="o">=</span><span class="n">correlations</span><span class="p">)</span>

<span class="c1"># Plot likelihood in 3D</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">csn</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">grid3d</span><span class="p">(</span><span class="n">backprojection</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Likelihood&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_constant_velocity_localization_13_0.png" src="../_images/examples_constant_velocity_localization_13_0.png" />
</div>
</div>
</section>
<section id="Compare-maximum-likelihood-with-known-source-location">
<h2>Compare maximum likelihood with known source location<a class="headerlink" href="#Compare-maximum-likelihood-with-known-source-location" title="Link to this heading">#</a></h2>
<p>The maximum likelihood of the source location is calculated using the method :func:<code class="docutils literal notranslate"><span class="pre">~covseisnet.backprojection.DifferentialBackProjection.maximum_coordinates</span></code>. We plot the source location and the maximum likelihood of the source location on the map.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Infer maximum coordinates</span>
<span class="n">max_likelihood</span> <span class="o">=</span> <span class="n">backprojection</span><span class="o">.</span><span class="n">maximum_coordinates</span><span class="p">()</span>

<span class="c1"># Plot source and estimated location</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">inventory</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">source_location</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;k*&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">fig</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">*</span><span class="n">max_likelihood</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;r*&quot;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">PlateCarree</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_constant_velocity_localization_15_0.png" src="../_images/examples_constant_velocity_localization_15_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x14950bb60&gt;]
</pre></div></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="constant_velocity_travel_times.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Constant differential times</p>
      </div>
    </a>
    <a class="right-next"
       href="../tutorials.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorials</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Load-seismograms">Load seismograms</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Station-and-source-coordinates">Station and source coordinates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Evaluate-covariance-matrix">Evaluate covariance matrix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Evaluate-the-pairwise-cross-correlation-functions">Evaluate the pairwise cross-correlation functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Calculate-travel-times">Calculate travel times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Locate-the-source-with-backprojection">Locate the source with backprojection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Compare-maximum-likelihood-with-known-source-location">Compare maximum likelihood with known source location</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Léonard Seydoux, Jean Soubestre, Cyril Journeau, Francis Tong & Nikolai Shapiro
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022, The Covseisnet Team.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>